# Quantumult X 复写规则 - TikTok 解锁 (2025 优化版)
# 注意：需配合日本或其他目标地区的代理节点，并启用 MitM
# 规则来源参考：https://github.com/Semporia/TikTok-Unlock

# 替换地区参数 (_region=CN 改为 JP)
^(.*)_region=CN(&.*)?$ url 307 $1_region=JP$2

# 替换移动网络代码 (mcc_mnc，中国 460xx 改为日本 44001)
^(.*)&mcc_mnc=460[0-1][0-9](&.*)?$ url 307 $1&mcc_mnc=44001$2

# 替换运营商参数 (carrier 改为 docomo，日本运营商)
^(.*)&carrier=[%A-Z0-9]+(&.*)?$ url 307 $1&carrier=docomo$2

# 替换时区参数 (tz_name，Asia/Shanghai 改为 Asia/Tokyo)
^(.*)tz_name=Asia/Shanghai(&.*)?$ url 307 $1tz_name=Asia/Tokyo$2

# 替换时区偏移 (timezone，8 改为 9)
^(.*)timezone=8(&.*)?$ url 307 $1timezone=9$2

# 移除不必要的查询参数 (针对 tnc/dm 域名，保留核心路径)
^(https?:\/\/(tnc|dm)[\w-]+\.\w+\.com\/.+?)(\?.*)?$ url 302 $1

# 通用 TikTok 域名重定向 (确保请求路由到正确地区)
^https?:\/\/.*\.tiktok(v)?\.com\/.* url request-header User-Agent: TikTok.* request-header User-Agent: TikTok/26.2.0 (iOS; iPhone; en_JP)

# 额外头信息伪装 (模拟日本设备环境)
^https?:\/\/.*\.tiktok(v)?\.com\/.* url request-header Accept-Language: zh-CN url request-header Accept-Language: ja-JP

hostname = *.tiktokv.com, *.byteoversea.com, *.tik-tokapi.com, *.tiktok.com, *.bytecdn.com, *.tiktokcdn.com